"use strict";const t=[.2,3/8,5/9,2/3],correctionData=(o,r)=>n=>{const s=4*o+n-4,c="*-04-39?2$%%$%%'$%''%'''%')(%'))%(++'(++'(+.'+-.',/3',33)-/5)-43).36)058*18<+37<+4:<,4:E,5<A-7>C/8@F/:EH/<EK0=FM1?IP2@KS3BNV4DPY5FS\\6HV_6IXb7K[e8N^i9Pam;Rdp<Tgt".charCodeAt(s)-35,f=s>8?c:1,i=r/f|0,l=r%f,a=f-l,u=s>8?i*t[n]+(o>5)&-2:c,_=i-u;return{t:8*(a*_+l*(_+1)),o:l?[[a,_],[l,_+1]]:[[a,_]],i:u}},o={min:0,l:0,u:1,Q:2,_:3,max:3},makeUint8Array=t=>new Uint8Array(t),fail=t=>{const o=new Error(`lean-qr error ${t}`);throw o.code=t,o},alnum=t=>"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:".indexOf(t),firstCharCode=t=>t.charCodeAt(0),multi=(...t)=>(o,r)=>t.forEach((t=>t(o,r))),eci=t=>o=>{o.m!==t&&(o.push(7,4),o.push(t,8),o.m=t)},bytes=t=>(o,r)=>{o.push(4,4),o.push(t.length,8+8*(r>9)),t.forEach((t=>o.push(t,8)))},makeMode=(t,o,r,n,s=((t,o)=>r(t.length,o)),c=(n?o=>multi(eci(n),t(o)):t))=>(c.test=o,c.h=r,c.p=s,c.m=n&&[n],c),r=makeMode((t=>(o,r)=>{o.push(1,4),o.push(t.length,10+2*(r>26)+2*(r>9));let n=0;for(;n<t.length-2;n+=3)o.push(+t.slice(n,n+3),10);n<t.length-1?o.push(+t.slice(n,n+2),7):n<t.length&&o.push(+t[n],4)}),/./.test.bind(/[0-9]/),((t,o)=>14+2*(o>26)+2*(o>9)+10*t/3)),n=makeMode((t=>(o,r)=>{o.push(2,4),o.push(t.length,9+2*(r>26)+2*(r>9));let n=0;for(;n<t.length-1;n+=2)o.push(45*alnum(t[n])+alnum(t[n+1]),11);n<t.length&&o.push(alnum(t[n]),6)}),(t=>alnum(t)>=0),((t,o)=>13+2*(o>26)+2*(o>9)+5.5*t)),s=makeMode((t=>bytes([...t].map(firstCharCode))),(t=>firstCharCode(t)<128),((t,o)=>12+8*(o>9)+8*t));s.M=!0;const c=makeMode(s,(t=>firstCharCode(t)<256),s.h,3);c.M=!0;const f=new TextEncoder,i=makeMode((t=>bytes(f.encode(t))),(()=>1),0,26,((t,o)=>12+8*(o>9)+8*f.encode(t).length));i.M=!0;let shiftJISMap=()=>{const t=new Map,o=new TextDecoder("sjis"),r=makeUint8Array(2);for(let n=0;n<7973;++n)r[0]=n/192+129+64*(n>5951),r[1]=n%192+64,t.set(o.decode(r),n);return t.delete("\ufffd"),shiftJISMap=()=>t,t};const l=makeMode((t=>(o,r)=>{o.push(8,4),o.push(t.length,8+2*(r>26)+2*(r>9));for(const r of t)o.push(shiftJISMap().get(r),13)}),(t=>shiftJISMap().has(t)),((t,o)=>12+2*(o>26)+2*(o>9)+13*t));l.M=!0;const a=[r,n,s,c,l,i],u={C:(t,{S:o=a}={})=>(r,n)=>{let c=1;for(const r of o){const o=new Map;r.T=c<<=1,r.V=r.p("",n),r.$=r.h?(t,s)=>{const c=s-t,f=o.get(c)??r.h(c,n);return o.set(c,f),f}:(s,c)=>{const f=t.slice(s,c),i=o.get(f)??r.p(f,n);return o.set(f,i),i}}let f=[{v:0}],i=0,l=0,a=-1;for(const r of[...t,""]){let t=0;if(r)for(const n of o)n.test(r)&&(t|=n.T);if(!r||t!==a){if(-1!==a){const t=new Set(f.map((t=>t.A))),r=[];for(const n of o.filter((t=>a&t.T))){const o=n.$(i,l);for(const c of n.m??t){if(n===s&&c)continue;let t;for(const r of f)if(r.A===c||n.m){const s=r.D===n&&r.A===c,f=s?r.F:r,a=s?r.H:i;let u;u=n.M&&s?r.v+o-n.V:f.v+12*(f.A!==c)+(a===i?o:n.$(a,l)),(!t||u<t.v)&&(t={H:a,F:f,D:n,A:c,I:l,v:u})}t&&r.push(t)}}r.length||fail(5),f=r}a=t,i=l}l+=r.length}const u=[];for(let o=f.reduce(((t,o)=>o.v<t.v?o:t));o.D;o=o.F)u.unshift(o.D(t.slice(o.H,o.I)));u.forEach((t=>t(r,n)))},K:multi,m:eci,L:r,N:n,P:bytes,B:s,U:c,X:l,Y:i},Bitmap1D=()=>({j:makeUint8Array(2956),R:0,push(t,o){for(let r=o,n=8-(7&this.R);r>0;r-=n,n=8)this.j[this.R>>3]|=t<<n>>r,this.R+=r<n?r:n}}),Bitmap2D=(t,o=t*t,r=makeUint8Array(o))=>({size:t,k:r,get:(o,n)=>o>=0&&o<t&&!!(1&r[n*t+o]),q(o,n,s){r[n*t+o]=s},G(o,{J:r=[0,0,0],O:n=[0,0,0,0],W:s=4,Z:c=4}={}){const f=t+2*s,i=t+2*c,l=o.createImageData(f,i),a=new Uint32Array(l.data.buffer);l.data.set([...r,255]);const u=a[0];l.data.set([...n,255]);const _=a[0];for(let t=0;t<i;++t)for(let o=0;o<f;++o)a[t*f+o]=this.get(o-s,t-c)?u:_;return l},tt(t,o){const r=t.getContext("2d"),n=this.G(r,o);t.width=n.width,t.height=n.height,r.putImageData(n,0,0)}}),_=[(t,o)=>!(1&(t^o)),(t,o)=>!(1&o),t=>!(t%3),(t,o)=>!((t+o)%3),(t,o)=>!(1&(t/3^o>>1)),(t,o)=>!((t&o&1)+t*o%3),(t,o)=>!((t&o&1)+t*o%3&1),(t,o)=>!((1&(t^o))+t*o%3&1)],d=makeUint8Array(512);d[0]=1;for(let t=0,o=1;t<255;d[++t]=o)d[o+256]=t,o*=2,256&o&&(o^=285);const e=t=>d[t%255],ln=t=>d[t+256],mult256PolyLn=(t,o)=>{const r=makeUint8Array(t.length+o.length-1);for(let n=0;n<t.length;++n)for(let s=0;s<o.length;++s)r[n+s]^=e(t[n]+o[s]);return r.map(ln)},rem256Poly=(t,o)=>{const r=makeUint8Array(t.length+o.length-1);r.set(t,0);for(let n=0;n<t.length;++n)if(r[n]){const t=ln(r[n]);for(let s=0;s<o.length;++s)r[n+s]^=e(o[s]+t)}return r.slice(t.length)},m=[[0],[0,0]];for(let t=1,o=m[1];t<30;++t){const r=mult256PolyLn(o,[0,t]);m.push(r),o=r}const calculateEC=(t,o)=>{const r=[[],[]];let n=0,s=0;for(const[c,f]of o.o)for(let i=0;i<c;++i,n+=f){const c=t.slice(n,n+f);r[0].push(c),r[1].push(rem256Poly(c,m[o.i])),s+=f+o.i}const c=makeUint8Array(s);let f=0;for(const t of r)for(let o,r=0;f!==o;++r){o=f;for(const o of t)r<o.length&&(c[f++]=o[r])}return c},remBinPoly=(t,o,r)=>{let n=t<<r-1;for(let t=134217728;t;t>>=1)n&t&&(n^=o*(t>>r-1));return n},drawFrame=({size:t,k:o,q:r},n)=>{const drawRect=(r,n,s,c,f)=>{for(;c-- >0;){const i=(n+c)*t+r;o.fill(f,i,i+s)}},drawPlacement=(t,o)=>{drawRect(t-3,o-3,7,7,3),drawRect(t-2,o-2,5,5,2),drawRect(t-1,o-1,3,3,3)},drawAlignment=(t,o)=>{drawRect(t-2,o-2,5,5,3),drawRect(t-1,o-1,3,3,2),r(t,o,3)};drawRect(7,0,2,9,2),drawRect(t-8,0,8,9,2);for(let o=0;o<t;++o)r(o,6,3^1&o);if(drawPlacement(3,3),drawPlacement(t-4,3),n>1){const o=1+(n/7|0),r=2*((t-13)/o/2+.75|0);for(let n=0;n<o;++n){const s=t-7-n*r;n&&drawAlignment(s,6);for(let n=0;n<o;++n)drawAlignment(s,t-7-n*r)}}if(n>6)for(let o=n<<12|remBinPoly(n,7973,13),s=0;s<6;++s)for(let n=12;n-- >9;o>>=1)r(t-n,s,2|1&o);for(let r=0;r<t;++r)for(let n=r;n<t;++n)o[n*t+r]=o[r*t+n];r(8,t-8,3)},getPath=({size:t,k:o})=>{const r=[];for(let n=t-2,s=t,c=-1;n>=0;n-=2){for(5===n&&(n=4);s+=c,-1!==s&&s!==t;){const c=s*t+n;o[c+1]<2&&r.push(c+1),o[c]<2&&r.push(c)}c*=-1}return r},drawCode=({k:t},o,r)=>o.forEach(((o,n)=>t[o]=r[n>>3]>>7-(7&n)&1)),applyMask=({size:t,k:o,q:r},n,s,c)=>{for(let r=0;r<t;++r)for(let s=0;s<t;++s){const c=r*t+s;o[c]^=n(s,r)&(o[c]>>1^1)}const f=(1^c)<<3|s;let i=21522^(f<<10|remBinPoly(f,1335,11));for(let o=8;o-- >0;i>>=1)r(8,(o>1?7:8)-o,i),r(t-8+o,8,i);for(let o=7;o-- >0;i>>=1)r(o>5?7:o,8,i),r(8,t-o-1,i)},scoreCode=({size:t,k:o},r=0,n=0)=>{for(let s=0;s<t;++s){for(let c=0;c<2;++c)for(let f,i=0,l=0,a=0;i<t;++i){const u=1&o[c?s*t+i:i*t+s];n+=u,l=(l>>1|2098176)&(3047517^u-1),2049&l&&(r+=40),u!==f?(a=1,f=u):++a>4&&(r+=a<6?3:1)}if(s)for(let n=1,c=1&o[s-1],f=(1&o[s])===c;n<t;++n){const i=1&o[n*t+s-1],l=(1&o[n*t+s])===i;r+=3*(f&&l&&c===i),c=i,f=l}}return r+10*(20*Math.abs(n/(t*t*2)-.5)|0)},h=[],generate=(t=fail(1),{ot:r=o.min,et:n=o.max,rt:s=1,nt:c=40,mask:f,st:i=60433,...l}={})=>{n<r&&fail(3),c<s&&fail(2),"string"==typeof t&&(t=u.C(t,l));for(let o=s,l=0;o<=c;++o){let s=h[o];s||(h[o]=s=Bitmap2D(4*o+17),drawFrame(s,o),s.ct=getPath(s));const c=correctionData(o,s.ct.length>>3);if(c(r).t<l)continue;const a=Bitmap1D();t(a,o),l=a.R;for(let t=n;t>=r;--t){const o=c(t);if(o.t<l)continue;for(a.push(0,4),a.R=a.R+7&-8;a.R<o.t;)a.push(i,16);const r=Bitmap2D(s.size,s.k);return drawCode(r,s.ct,calculateEC(a.j,o)),(_[f??-1]?[_[f]]:_).map(((o,n)=>{const s=Bitmap2D(r.size,r.k);return applyMask(s,o,f??n,t),s.s=scoreCode(s),s})).reduce(((t,o)=>o.s<t.s?o:t))}}fail(4)};generate.with=(...t)=>(o,r)=>generate(o,{S:[...a,...t],...r}),globalThis.__rollup_no_tree_shaking={correction:o,mode:u,generate:generate};
